# GAP-анализ: proto.html vs Схемы проектирования

**Дата:** 2025-12-10
**Источники:**
- `Портал обучения - Сущности.jpg` — модель данных
- `Портал обучения - Шаги.jpg` — user journey по ролям
- `proto.html` — текущий прототип

---

## 1. Сводка по сущностям

| Сущность на схеме | В прототипе | GAP |
|---|---|---|
| Пользователь | `mockStudent`, `mockTeacher` | OK |
| Слушатель курса | `enrollments` | OK |
| Преподаватель курса | `teacherId` в курсе | Упрощено (нет отдельной связи) |
| **Методист курса** | — | **НЕТ** |
| Шаблон курса | `courses` (совмещено) | Нет разделения |
| Экземпляр курса | `courses` (совмещено) | Нет разделения |
| Шаблон задания | `assignments` (совмещено) | Нет разделения |
| Экземпляр задания | `assignmentInstances` | OK |
| **Шаги задания** | — | **НЕТ** |
| **Заявка на регистрацию** | — | **НЕТ** |
| Сертификат (шаблон) | — | **НЕТ** |
| Экземпляр сертификата | `certificates` | OK |
| **Расписания** | — | **НЕТ** |
| **Правила доступа** | — | **НЕТ** |

---

## 2. Сводка по экранам/функциям

### Публичный доступ (Гость)
| Функция | Статус | Что нужно |
|---|---|---|
| Стартовая страница | ❌ | Лендинг с описанием системы |
| Реестр публичных курсов | ❌ | Каталог без авторизации |
| Описание курса (публичное) | ❌ | Карточка курса для гостя |
| Заявка на участие/регистрацию | ❌ | Форма заявки |

### Студент
| Функция | Статус | Что нужно |
|---|---|---|
| Дашборд (список курсов) | ✅ | — |
| Форма курса (описание, задания) | ✅ | — |
| Прогресс-бар | ✅ | — |
| Чат с преподавателем | ⚠️ | Только комментарии, нет real-time |
| Практика по курсу | ⚠️ | Нет навигации "где по..." |
| **Тестирование/опросы** | ❌ | Форма теста |
| Просмотр сертификатов | ✅ | — |

### Преподаватель (подготовка)
| Функция | Статус | Что нужно |
|---|---|---|
| Реестр курсов | ⚠️ | Только просмотр |
| **Создание/редактирование курса** | ❌ | Конструктор |
| **Реестр заданий с редактированием** | ❌ | CRUD заданий |
| **Шаги задания** | ❌ | Картинки, ссылки, материалы |

### Преподаватель (проведение)
| Функция | Статус | Что нужно |
|---|---|---|
| Реестр экземпляров курсов | ⚠️ | Совмещено с шаблонами |
| **Состав участников** | ❌ | Список слушателей |
| **Итоговый запуск курса** | ❌ | Кнопка "Запустить" |
| Мониторинг статуса (gradebook) | ✅ | — |
| **Оценивание в UI** | ❌ | Модальное окно оценки |
| **Выдача сертификатов** | ❌ | Ручная/авто генерация |

### Методист
| Функция | Статус | Что нужно |
|---|---|---|
| **Вся роль** | ❌ | Создание шаблонов курсов |

### Администратор
| Функция | Статус | Что нужно |
|---|---|---|
| **Управление пользователями** | ❌ | CRUD пользователей |
| **Одобрение заявок** | ❌ | Очередь заявок |
| **Настройки системы** | ❌ | Конфигурация |

---

## 3. Необходимые изменения

### 3.1 Объекты данных (Data Model)

#### Новые сущности

```
CourseTemplate (Шаблон курса)
├── id: UUID
├── code: string
├── title: string
├── description: text
├── level: enum [basic, advanced, expert]
├── methodistId: -> User
├── isPublic: boolean
├── status: enum [draft, published, archived]
└── createdAt, updatedAt

CourseInstance (Экземпляр курса)
├── id: UUID
├── templateId: -> CourseTemplate
├── teacherId: -> User
├── startDate: date
├── endDate: date
├── status: enum [planned, active, completed, cancelled]
├── maxStudents: number
└── enrollmentDeadline: date

AssignmentTemplate (Шаблон задания)
├── id: UUID
├── courseTemplateId: -> CourseTemplate
├── title: string
├── description: text
├── type: enum [lecture, lab, test, project]
├── order: number
├── dueDays: number (nullable)
└── maxScore: number

AssignmentStep (Шаг задания)
├── id: UUID
├── assignmentTemplateId: -> AssignmentTemplate
├── order: number
├── title: string
├── content: text (markdown/html)
├── mediaUrl: string (nullable)
└── type: enum [text, video, image, link, file]

RegistrationRequest (Заявка на регистрацию)
├── id: UUID
├── userId: -> User (nullable, для гостей)
├── courseInstanceId: -> CourseInstance
├── guestEmail: string (nullable)
├── guestName: string (nullable)
├── status: enum [pending, approved, rejected]
├── reviewedBy: -> User (nullable)
├── reviewedAt: datetime (nullable)
└── comment: text

CertificateTemplate (Шаблон сертификата)
├── id: UUID
├── courseTemplateId: -> CourseTemplate
├── title: string
├── bodyTemplate: text (с плейсхолдерами)
└── printFormId: -> B3PrintForm

Schedule (Расписание) — опционально для MVP
├── id: UUID
├── courseInstanceId: -> CourseInstance
├── dayOfWeek: enum
├── startTime: time
├── endTime: time
└── location: string

AccessRule (Правила доступа) — опционально для MVP
├── id: UUID
├── courseTemplateId: -> CourseTemplate
├── ruleType: enum [prerequisite, role, department]
├── ruleValue: string
└── isRequired: boolean
```

#### Изменения существующих

```
User (Пользователь)
+ role: enum [guest, student, methodist, teacher, admin]
+ department: string (nullable)
+ position: string (nullable)

Enrollment (Запись на курс)
~ courseId -> courseInstanceId: -> CourseInstance
+ enrolledAt: datetime
+ completedAt: datetime (nullable)

AssignmentInstance (Экземпляр задания)
~ assignmentId -> assignmentTemplateId: -> AssignmentTemplate
+ courseInstanceId: -> CourseInstance
+ currentStepId: -> AssignmentStep (nullable)

Certificate (Экземпляр сертификата)
+ templateId: -> CertificateTemplate
~ courseId -> courseInstanceId: -> CourseInstance
```

---

### 3.2 Формы и экраны

#### Публичная часть (Guest)

| Экран | Компоненты | Действия |
|---|---|---|
| **Лендинг** | Hero-секция, описание системы, кнопка "Каталог" | Переход к каталогу |
| **Каталог курсов** | Карточки публичных курсов, фильтры по уровню | Клик → Карточка курса |
| **Карточка курса (публичная)** | Описание, программа, преподаватель, кнопка "Подать заявку" | Открытие формы заявки |
| **Форма заявки** | ФИО, email, мотивация | Отправка заявки |

#### Студент

| Экран | Изменения |
|---|---|
| **Дашборд** | + Уведомления, + "Мои заявки" |
| **Форма курса** | + Навигация по шагам задания |
| **Тест/опрос** | НОВЫЙ: вопросы, варианты, таймер |
| **Результаты теста** | НОВЫЙ: оценка, правильные ответы |

#### Методист (НОВАЯ роль)

| Экран | Компоненты | Действия |
|---|---|---|
| **Дашборд методиста** | Список шаблонов курсов | Создать/редактировать |
| **Конструктор шаблона курса** | Поля курса, список заданий | Сохранить, опубликовать |
| **Конструктор задания** | Поля задания, список шагов | CRUD шагов |
| **Редактор шага** | Тип, контент, медиа | Drag-drop сортировка |
| **Шаблон сертификата** | Плейсхолдеры, превью | Связь с печатной формой B3 |

#### Преподаватель

| Экран | Изменения |
|---|---|
| **Дашборд** | + Разделение: "Мои экземпляры" vs "Доступные шаблоны" |
| **Создание экземпляра** | НОВЫЙ: выбор шаблона, даты, лимит |
| **Карточка экземпляра** | + Список участников, + "Запустить курс" |
| **Участники курса** | НОВЫЙ: таблица слушателей, статусы |
| **Gradebook** | + Модальное окно оценивания |
| **Выдача сертификатов** | НОВЫЙ: список завершивших, кнопка "Выдать" |

#### Администратор (НОВАЯ роль)

| Экран | Компоненты | Действия |
|---|---|---|
| **Очередь заявок** | Таблица заявок, фильтры | Одобрить/отклонить |
| **Управление пользователями** | Таблица, поиск, фильтры | CRUD, назначение ролей |
| **Отчёты** | Графики, экспорт | Фильтрация по периоду |
| **Настройки** | Параметры системы | Сохранить |

---

### 3.3 BPMN-процессы

#### 1. Заявка на курс
```
[Гость/Студент] → Подача заявки → [Админ] Рассмотрение
    ├── Одобрено → Создание Enrollment → Уведомление студенту
    └── Отклонено → Уведомление с причиной
```

#### 2. Проверка задания
```
[Студент] Отправка → Статус "На проверке" → [Преподаватель] Ревью
    ├── Принято → Оценка → Уведомление → Проверка завершения курса
    └── Доработка → Комментарий → Уведомление студенту
```

#### 3. Выдача сертификата
```
[Система] Все задания приняты → Проверка условий
    ├── Авто-выдача ON → Генерация сертификата → Уведомление
    └── Ручная выдача → Задача преподавателю → [Преподаватель] Выдать
```

#### 4. Запуск экземпляра курса
```
[Преподаватель] Создание экземпляра → Наполнение (участники, даты)
    → "Запустить" → Статус "active" → Уведомления участникам
```

---

### 3.4 Приоритеты реализации

#### MVP (Phase 1)
1. Разделение Шаблон/Экземпляр курса
2. Роль Методист (базовый конструктор)
3. Заявки на регистрацию
4. Модальное оценивание в gradebook
5. Выдача сертификатов (ручная)

#### Phase 2
6. Шаги задания
7. Публичный каталог (гость)
8. Роль Администратор
9. Тестирование/опросы
10. Уведомления

#### Phase 3
11. Расписания
12. Правила доступа
13. Автоматическая выдача сертификатов
14. Отчёты и аналитика

---

## 4. Оценка объёма доработок

| Категория | Количество | Сложность |
|---|---|---|
| Новые сущности | 6 | Средняя |
| Изменения сущностей | 4 | Низкая |
| Новые экраны | ~15 | Высокая |
| Изменения экранов | ~8 | Средняя |
| BPMN-процессы | 4 | Средняя |
| Новые роли | 2 (Методист, Админ) | Средняя |

**Вывод:** Текущий прототип покрывает ~40% требуемого функционала. Основной GAP — отсутствие ролей Методист/Админ, разделения шаблонов и экземпляров, публичного доступа и заявок.
